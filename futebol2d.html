<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Futebol 2D com Advers√°rio</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #4CAF50;
    }
    canvas {
      display: block;
      margin: auto;
      background: #87CEEB;
      border: 5px solid #333;
    }
    #joystick {
      position: absolute;
      bottom: 20px;
      left: 20px;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="800" height="500"></canvas>
  <div id="joystick"></div>

  <script src="https://cdn.jsdelivr.net/npm/nipplejs@0.9.0/dist/nipplejs.min.js"></script>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const ball = { x: 400, y: 250, radius: 15, speed: 3 };
    const player = { x: 100, y: 250, width: 20, height: 20, speed: 3 };
    const opponent = { x: 600, y: 250, width: 20, height: 20, speed: 2 };

    const goalLeft = { x: 0, y: 200, width: 20, height: 100 };
    const goalRight = { x: 780, y: 200, width: 20, height: 100 };

    const goalieLeft = { x: goalLeft.x + goalLeft.width, y: goalLeft.y + 40, width: 10, height: 20, speed: 2, direction: 1 };
    const goalieRight = { x: goalRight.x - 10, y: goalRight.y + 40, width: 10, height: 20, speed: 2, direction: 1 };

    let dx = 0, dy = 0;
    let shootCooldown = 0;
    let ballAttached = false;

    function drawField() {
      ctx.fillStyle = '#4CAF50';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#FFFFFF';
      ctx.fillRect(goalLeft.x, goalLeft.y, goalLeft.width, goalLeft.height);
      ctx.fillRect(goalRight.x, goalRight.y, goalRight.width, goalRight.height);
    }

    function drawBall() {
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
      ctx.fillStyle = '#FFD700';
      ctx.fill();
      ctx.closePath();
    }

    function drawPlayer(p, color) {
      ctx.fillStyle = color;
      ctx.fillRect(p.x, p.y, p.width, p.height);
    }

    function updatePlayer() {
      player.x += dx * player.speed;
      player.y += dy * player.speed;
      player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));
      player.y = Math.max(0, Math.min(canvas.height - player.height, player.y));
    }

    function updateBall() {
      if (ballAttached) {
        ball.x = player.x + player.width / 2;
        ball.y = player.y + player.height / 2;
      }
      ball.x = Math.max(ball.radius, Math.min(canvas.width - ball.radius, ball.x));
      ball.y = Math.max(ball.radius, Math.min(canvas.height - ball.radius, ball.y));
    }

    function updateOpponent() {
      const angle = Math.atan2(ball.y - opponent.y, ball.x - opponent.x);
      opponent.x += Math.cos(angle) * opponent.speed;
      opponent.y += Math.sin(angle) * opponent.speed;
    }

    function updateGoalie(g, goal) {
      g.y += g.speed * g.direction;
      if (g.y < goal.y || g.y + g.height > goal.y + goal.height) {
        g.direction *= -1;
      }
    }

    function collides(a, b) {
      return (
        a.x + a.width > b.x &&
        a.x < b.x + b.width &&
        a.y + a.height > b.y &&
        a.y < b.y + b.height
      );
    }

    function checkBallPickup() {
      const tempPlayer = { x: player.x, y: player.y, width: player.width, height: player.height };
      const tempBall = { x: ball.x - ball.radius, y: ball.y - ball.radius, width: ball.radius * 2, height: ball.radius * 2 };
      if (collides(tempPlayer, tempBall)) {
        ballAttached = true;
      }
    }

    function autoShoot() {
      if (
        ball.x + ball.radius > goalRight.x &&
        ball.y > goalRight.y &&
        ball.y < goalRight.y + goalRight.height &&
        shootCooldown === 0
      ) {
        ballAttached = false;
        ball.x += 10;
        ball.y += (Math.random() - 0.5) * 30;
        shootCooldown = 60;
      }
    }

    function checkGoal() {
      if (
        ball.x + ball.radius > goalRight.x &&
        ball.y > goalRight.y &&
        ball.y < goalRight.y + goalRight.height &&
        !collides(ball, goalieRight)
      ) {
        ctx.font = '40px Arial';
        ctx.fillStyle = 'white';
        ctx.fillText('GOOOOL!', canvas.width / 2 - 100, 50);
      }
    }

    function gameLoop() {
      drawField();
      updatePlayer();
      updateBall();
      updateOpponent();
      updateGoalie(goalieLeft, goalLeft);
      updateGoalie(goalieRight, goalRight);
      checkBallPickup();
      autoShoot();
      checkGoal();

      drawBall();
      drawPlayer(player, '#00FF00');
      drawPlayer(opponent, '#0000FF');
      drawPlayer(goalieLeft, '#FF0000');
      drawPlayer(goalieRight, '#FF0000');

      if (shootCooldown > 0) shootCooldown--;

      requestAnimationFrame(gameLoop);
    }

    const joystick = nipplejs.create({
      zone: document.getElementById('joystick'),
      mode: 'static',
      position: { left: '60px', bottom: '60px' },
      color: 'white'
    });

    joystick.on('move', (evt, data) => {
      if (data && data.vector) {
        dx = data.vector.x;
        dy = data.vector.y;
      }
    });

    joystick.on('end', () => {
      dx = 0;
      dy = 0;
    });

    gameLoop();
  </script>
</body>
</html>
